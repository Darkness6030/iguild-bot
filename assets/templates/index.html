<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iGuild Ads</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://w.tads.me/widget.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #loader, #no-ads {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #no-ads {
            display: none;
            color: var(--tg-theme-accent-text-color);
            font-size: 18px;
        }
        #loader {
            display: block;
            width: 48px;
        }
        #ads-content {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
<div id="ads-content">
    <div id="tads-container-368"></div>
</div>
<div id="loader">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
        <circle fill="#FF156D" stroke="#FF156D" stroke-width="15" r="15" cx="40" cy="65">
            <animate attributeName="cy" calcMode="spline" dur="2" values="65;135;65;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.4"></animate>
        </circle>
        <circle fill="#FF156D" stroke="#FF156D" stroke-width="15" r="15" cx="100" cy="65">
            <animate attributeName="cy" calcMode="spline" dur="2" values="65;135;65;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="-.2"></animate>
        </circle>
        <circle fill="#FF156D" stroke="#FF156D" stroke-width="15" r="15" cx="160" cy="65">
            <animate attributeName="cy" calcMode="spline" dur="2" values="65;135;65;" keySplines=".5 0 .5 1;.5 0 .5 1" repeatCount="indefinite" begin="0"></animate>
        </circle>
    </svg>
</div>
<div id="no-ads">No ads available now.</div>

<script>
    const tg = window.Telegram.WebApp;
    const userId = tg.initDataUnsafe?.user?.id;

    const adsNotFoundCallback = () => {
        console.log('No ads found to show');
        document.getElementById("loader").style.display = "none";
        document.getElementById("no-ads").style.display = "block";
    };

    const sendWatchAdRequest = () => {
        setTimeout(() => {
            fetch(`/watch_ad?user_id=${userId}`, {
                method: 'POST'
            }).then(() => tg.close());
        }, 5000);
    };

    const adController = window.tads.init({
        widgetId: "368",
        debug: false,
        onShowReward: (adId) => {
            console.log('Show ad:', adId);
            document.getElementById("loader").style.display = "none";
        },
        onClickReward: (adId) => {
            console.log('Click on ad:', adId);
            sendWatchAdRequest();
        },
        onAdsNotFound: adsNotFoundCallback
    });

    adController.loadAd()
        .then(() => adController.showAd())
        .catch((err) => {
            console.log(err);
            adsNotFoundCallback();
        });
</script>
</body>
</html>